<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KittyAI - Welcome</title>
<style>
  /* (same styles as before, omitted here for brevity) */
  /* ... */
</style>
</head>
<body>
  <div class="container">

    <!-- Sidebar (hidden by default, shown after login) -->
    <aside id="sidebar" style="display:none;">
      <h3>KittyAI Admin</h3>
      <nav>
        <a href="#" title="Dashboard">üè† Dashboard</a>
        <a href="#" title="Login Requests">üì• Login Requests</a>
        <a href="/logout" title="Logout">üö™ Logout</a>
      </nav>
      <div id="login-requests">
        <h4>Login Requests</h4>
        <ul>
          <li><strong>12:15 AM</strong> - user123</li>
          <li><strong>12:30 PM</strong> - cooladmin</li>
          <li><strong>1:05 PM</strong> - testuser</li>
        </ul>
      </div>
    </aside>

    <!-- Login panel -->
    <section class="login-panel" id="login-panel">
      <h1>KittyAI</h1>
      <h2>Welcome, Admin</h2>

      <!-- Bot status: hidden initially, shown after login -->
      <div class="status" id="bot-status" style="display:none;">
        <div class="status-dot status-offline"></div>
        <span>Offline</span> - Uptime: 0s
      </div>

      <form id="login-form">
        <input type="text" id="username" name="username" placeholder="Username" autocomplete="username" required />
        <input type="password" id="password" name="password" placeholder="Password" autocomplete="current-password" required />
        <button type="submit">Login</button>
      </form>

      <p id="login-msg" style="margin-top:15px;color:#f87171;display:none;"></p>
    </section>

  </div>

<script>
  const loginForm = document.getElementById("login-form");
  const loginMsg = document.getElementById("login-msg");
  const botStatusDot = document.querySelector(".status-dot");
  const botStatusText = document.querySelector(".status span");
  const botStatusContainer = document.getElementById("bot-status");
  const sidebar = document.getElementById("sidebar");
  const loginPanel = document.getElementById("login-panel");

  // Check bot status every 5s, but only after login
  let statusInterval = null;

  async function updateStatus() {
    try {
      const res = await fetch("/api/status");
      const data = await res.json();

      if (data.online) {
        botStatusDot.classList.remove("status-offline");
        botStatusDot.classList.add("status-online");
        botStatusText.textContent = `Online üü¢ - Uptime: ${data.uptime}`;
      } else {
        botStatusDot.classList.remove("status-online");
        botStatusDot.classList.add("status-offline");
        botStatusText.textContent = `Offline üî¥ - Uptime: 0s`;
      }
    } catch (e) {
      // network error, show offline
      botStatusDot.classList.remove("status-online");
      botStatusDot.classList.add("status-offline");
      botStatusText.textContent = `Offline üî¥ - Uptime: 0s`;
    }
  }

  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    loginMsg.style.display = "none";
    const username = e.target.username.value.trim();
    const password = e.target.password.value.trim();

    try {
      const res = await fetch("/api/admin-login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password }),
      });
      const result = await res.json();

      if (res.ok && result.success) {
        // Hide login form, show sidebar and bot status
        loginPanel.style.display = "none";
        sidebar.style.display = "flex";
        botStatusContainer.style.display = "flex";

        // Start status updater
        updateStatus();
        statusInterval = setInterval(updateStatus, 5000);
      } else {
        loginMsg.textContent = result.message || "Login failed";
        loginMsg.style.display = "block";
      }
    } catch (error) {
      loginMsg.textContent = "Network error";
      loginMsg.style.display = "block";
    }
  });
</script>

</body>
</html>
